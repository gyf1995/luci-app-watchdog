name: Build luci-app-watchdog

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      ARCH: x86_64     # 或改為你要的 target, e.g. mips_24kc
      # 如果你需要支援多架構，可以用 matrix
    steps:
    - name: Checkout source
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Clone luci-app-watchdog into package dir
      run: |
        git clone https://github.com/sirpdboy/luci-app-watchdog package/watchdog
        # 若倉庫名稱與 package name 衝突，也可以先刪除舊的 package，再 clone

    - name: Update feeds & install
      run: |
        ./scripts/feeds update -a
        ./scripts/feeds install -a

    - name: Configure build (defconfig)
      run: |
        # 這裡假設你已經有 .config 放在 repo 根目錄
        cp .config .config
      # 如果你沒有 .config，你也可以在這裡 echo 一個簡單 config

    - name: Compile watch-dog package
      run: |
        make package/watchdog/luci-app-watchdog/compile V=s

    - name: Upload built package
      uses: actions/upload-artifact@v3
      with:
        name: luci-app-watchdog-ipk
        path: bin/packages/**/luci-app-watchdog*.ipk
